<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>GIFnimator Web</title>
    <script>
        function uploadGIF(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append("gifFile", file);

            fetch("/upload", { method: "POST", body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert("Error al analizar el GIF: " + data.error);
                        return;
                    }

                    // Guardar la ruta temporal del archivo en el campo oculto
                    document.getElementById("gifFilePath").value = data.filePath;

                    // Mostrar propiedades del GIF
                    document.getElementById("gifName").innerText = data.name;
                    document.getElementById("gifSize").innerText = `${data.width} x ${data.height}`;
                    document.getElementById("gifFrames").innerText = data.frames;
                    document.getElementById("gifWeight").innerText = data.sizeKB + " KB";
                    document.getElementById("gifColors").innerText = data.colors;
                    document.getElementById("gifDuration").innerText = data.duration + " ms";

                    // Mostrar vista previa
                    document.getElementById("gifPreview").src = data.preview;
                    document.getElementById("gifPreview").style.display = "block";

                    // Activar el formulario de opciones
                    document.getElementById("gifInfo").style.display = "block";
                    document.getElementById("gifForm").style.display = "block";
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("Error al procesar el archivo. Inténtalo de nuevo.");
                });
        }
    </script>
</head>
<body>
    <h1>GIFnimator Web</h1>

    <label>Subir GIF: 
        <input type="file" id="gifFile" accept="image/gif" required onchange="uploadGIF(event)">
    </label>
    <br><br>

    <div id="gifInfo" style="display: none;">
        <h3>Propiedades del GIF</h3>
        <ul>
            <li><strong>Nombre:</strong> <span id="gifName"></span></li>
            <li><strong>Dimensiones:</strong> <span id="gifSize"></span></li>
            <li><strong>Frames:</strong> <span id="gifFrames"></span></li>
            <li><strong>Peso:</strong> <span id="gifWeight"></span></li>
            <li><strong>Colores:</strong> <span id="gifColors"></span></li>
            <li><strong>Duración Total:</strong> <span id="gifDuration"></span></li>
        </ul>
        <img id="gifPreview" style="max-width: 300px; display: none;" />
    </div>

    <form action="/process" method="POST" id="gifForm" style="display: none;">
        <input type="hidden" name="gifFilePath" id="gifFilePath">

        <label>Frames a conservar (deja vacío para no reducir):
            <input type="number" name="framesConservar" min="1">
        </label>
        <br><br>

        <label>Escala (%):
            <select name="escala">
                <option value="100">100%</option>
                <option value="50">50%</option>
                <option value="25">25%</option>
                <option value="12.5">12.5%</option>
            </select>
        </label>
        <br><br>

        <label>Estilo:
            <select name="estilo">
                <option value="original">Original</option>
                <option value="gameboy">GameBoy</option>
                <option value="vaporwave">VaporWave</option>
                <option value="solarpunk">SolarPunk</option>
                <option value="steampunk">SteamPunk</option>
                <option value="sumie">Sumi-e</option>
                <option value="popart">Pop Art</option>
                <option value="cyberpunk">Cyberpunk</option>
                <option value="noir">Noir</option>
                <option value="watercolor">Watercolor</option>
            </select>
        </label>
        <br><br>

        <button type="submit">Procesar</button>
    </form>
</body>
</html>
